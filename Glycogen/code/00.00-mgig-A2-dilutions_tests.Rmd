---
title: "00.00-mgig-A2-dilutions_tests.Rmd"
author: "Sam White"
date: "2026-01-12"
output: 
  github_document:
    toc: true
    number_sections: true
  bookdown::html_document2:
    theme: cosmo
    toc: true
    toc_float: true
    number_sections: true
    code_folding: show
    code_download: true
  html_document:
    theme: cosmo
    toc: true
    toc_float: true
    number_sections: true
    code_folding: show
    code_download: true
bibliography: references.bib
---
# BACKGROUND

This was the initial testing of the [Glycogen-Glo Assay (Promega)](https://github.com/RobertsLab/resources/blob/master/protocols/Commercial_Protocols/Promega_Glycogen_Glo_Assay.pdf) (GitHub; PDF) using _M.gigas_ (Pacific oyster) ctenidia homegenate from [20251210](https://robertslab.github.io/sams-notebook/posts/2025/2025-12-10-Tissue-Collection-and-Homogenization---M.gigas-Ctenidia-for-Glycogen-Glo-Assay/) (notebook entry).

The idea was to identify a range (i.e. a very rough min/max) of starting tissues amounts that will fall within the range of the Glycogen-Glo standard curves. Additionally, this was an initial walk-through of using this kit to help figure out a general protocol that identified any tips/tricks/pitfalls to aid in developing a Standard Operating Protocol (SOP) for the [Roberts Lab Handbook](https://robertslab.github.io/resources/).


```{r setup, include=FALSE}
library(knitr)
library(ggplot2)
library(dplyr)
knitr::opts_chunk$set(
  echo = TRUE,         # Display code chunks
  eval = FALSE,        # Evaluate code chunks
  warning = FALSE,     # Hide warnings
  message = FALSE,     # Hide messages
  comment = ""         # Prevents appending '##' to beginning of lines in code output
)
```

# DATA

```{r data, include=TRUE}

plate_layout <- read.csv("https://raw.githubusercontent.com/RobertsLab/sormi-assay-development/refs/heads/main/Glycogen/data/raw_luminescence/layout-Gen5-20260112-mgig-glycogen_glo-dilutions_test.csv", header = FALSE)
raw_luminescence <- read.csv("https://raw.githubusercontent.com/RobertsLab/sormi-assay-development/refs/heads/main/Glycogen/data/raw_luminescence/raw_lum-Gen5-20260112-mgig-glycogen_glo-dilutions_test.csv", header = FALSE)

print("Plate layout:")
str(plate_layout)

cat("\n\n")

print("Raw luminescence:")
str(raw_luminescence)
```

# STANDARD CURVES

## Glycogen Standard Curve

### Extract luminescence data

```{r extract-glycogen-data, include=TRUE}
# Extract glycogen standard curve data from plate layout and raw luminescence.
# Rows E, F, G (rows 5, 6, 7) correspond to glycogen standards
# Columns 1-5 contain the standard curve concentrations

# Extract concentration values from plate layout (row 5, columns 1-5)
# Parse concentration from labels like "STD-glyc-20" -> 20
concentrations <- as.numeric(gsub("STD-glyc-", "", plate_layout[5, 1:5]))

# Extract standard curve luminescence values for each replicate from raw_luminescence
row_E <- as.numeric(raw_luminescence[5, 1:5])  # Row 5 (E)
row_F <- as.numeric(raw_luminescence[6, 1:5])  # Row 6 (F)
row_G <- as.numeric(raw_luminescence[7, 1:5])  # Row 7 (G)

# Extract sample data from row A (columns 1, 3, 4, 5, 6)
# Parse tissue amounts from labels like "A2-glyc-50" -> 50
sample_cols <- c(1, 3, 4, 5, 6)
tissue_mg <- as.numeric(gsub("A2-glyc-", "", plate_layout[1, sample_cols]))
sample_luminescence <- as.numeric(raw_luminescence[1, sample_cols])
```


### Calculate summary statistics and linear regression
```{r glycogen-summary-data, include=TRUE}
#| results: hold


# Calculate mean and standard error for each concentration
means <- numeric(length(concentrations))
std_errors <- numeric(length(concentrations))
std_devs <- numeric(length(concentrations))

for (i in 1:length(concentrations)) {
  values <- c(row_E[i], row_F[i], row_G[i])
  means[i] <- mean(values)
  std_devs[i] <- sd(values)
  std_errors[i] <- sd(values) / sqrt(length(values))
}

# Create data frame for plotting
glycogen_summary_data <- data.frame(
  concentration = concentrations,
  mean_luminescence = means,
  se = std_errors,
  sd = std_devs,
  cv = (std_devs / means) * 100
)

# Calculate linear regression and R-squared
lm_model <- lm(mean_luminescence ~ concentration, data = glycogen_summary_data)
r_squared <- summary(lm_model)$r.squared
slope <- coef(lm_model)[2]
intercept <- coef(lm_model)[1]

# Create sample data frame
# Calculate glycogen concentration from luminescence using the standard curve equation
# Rearranging y = mx + b to solve for x: x = (y - b) / m
sample_glycogen_conc <- (sample_luminescence - intercept) / slope

sample_data <- data.frame(
  tissue_mg = tissue_mg,
  luminescence = sample_luminescence,
  glycogen_conc = sample_glycogen_conc,
  label = paste(tissue_mg, "mg")
)
```

### Plot Glycogen Standard Curve with Sample Points
```{r plot-glycogen-data, fig.width=10, fig.height=6, include=TRUE}
# Create the plot
plot <- ggplot(glycogen_summary_data, aes(x = concentration, y = mean_luminescence)) +
  geom_smooth(aes(linetype = "Std Curve Best Fit Line"), method = "lm", se = FALSE, 
              color = "coral", linewidth = 1) +
  geom_errorbar(aes(ymin = mean_luminescence - se, ymax = mean_luminescence + se),
                width = 0.1, linewidth = 1, color = "darkblue") +
  geom_point(aes(color = "Standard Curve", shape = "Standard Curve"), size = 4) +
  geom_point(data = sample_data, aes(x = glycogen_conc, y = luminescence,
             color = label, shape = label), size = 4) +
  scale_color_manual(name = "",
                     values = c("Standard Curve" = "steelblue",
                                "50 mg" = "darkred",
                                "2.5 mg" = "darkorange",
                                "0.25 mg" = "darkgreen",
                                "0.025 mg" = "purple",
                                "0 mg" = "brown")) +
  scale_shape_manual(name = "",
                     values = c("Standard Curve" = 16,
                                "50 mg" = 17,
                                "2.5 mg" = 15,
                                "0.25 mg" = 18,
                                "0.025 mg" = 8,
                                "0 mg" = 4)) +
  scale_linetype_manual(name = "",
                        values = c("Std Curve Best Fit Line" = "dashed")) +
  annotate("label", x = max(glycogen_summary_data$concentration) * 0.75, 
           y = max(glycogen_summary_data$mean_luminescence) * 0.15,
           label = sprintf("y = %.2fx + %.2f\nR² = %.4f", slope, intercept, r_squared),
           size = 3.5, fontface = "bold", fill = "white", 
           color = "coral", label.padding = unit(0.3, "lines")) +
  labs(
    title = "Glycogen Standard Curve",
    x = "Glycogen Concentration (µg/µL)",
    y = "Luminescence",
    caption = "Error bars represent standard error of the mean (SEM)"
  ) +
  scale_x_continuous(breaks = concentrations) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12, face = "bold"),
    panel.grid.minor = element_line(linetype = "dashed", color = "grey70")
  )

# Save the plot
ggsave("../output/00.00-mgig-A2-dilutions_tests.Rmd/glycogen_plot.png", plot, width = 10, height = 6, dpi = 300)

# Display the plot
plot

# Print summary statistics
cat("Glycogen Standard Curve Summary:\n")
cat(rep("=", 50), "\n", sep = "")
for (i in 1:nrow(glycogen_summary_data)) {
  cat(sprintf("Concentration: %g µg/µL\n", glycogen_summary_data$concentration[i]))
  cat(sprintf("  Mean Luminescence: %.2f\n", glycogen_summary_data$mean_luminescence[i]))
  cat(sprintf("  Standard Error: %.2f\n", glycogen_summary_data$se[i]))
  cat(sprintf("  CV%%: %.2f%%\n\n", glycogen_summary_data$cv[i]))
}
```

## Glucose Standard Curve

### Extract luminescence data

```{r extract-glucose-data, include=TRUE}
# Extract glucose standard curve data from plate layout and raw luminescence.
# Rows E, F, G (rows 5, 6, 7) correspond to glucose standards
# Columns 8-12 contain the standard curve concentrations

# Extract concentration values from plate layout (row 5, columns 8-12)
# Parse concentration from labels like "STD-gluc-100" -> 100
gluc_concentrations <- as.numeric(gsub("STD-gluc-", "", plate_layout[5, 8:12]))

# Extract standard curve luminescence values for each replicate from raw_luminescence
gluc_row_E <- as.numeric(raw_luminescence[5, 8:12])  # Row 5 (E)
gluc_row_F <- as.numeric(raw_luminescence[6, 8:12])  # Row 6 (F)
gluc_row_G <- as.numeric(raw_luminescence[7, 8:12])  # Row 7 (G)

# Extract sample data from rows C and D (rows 3 and 4, columns 1, 3, 4, 5, 6)
# Parse tissue amounts from labels like "A2-gluc-50" -> 50
# Skip column 2 (25mg samples)
gluc_sample_cols <- c(1, 3, 4, 5, 6)
gluc_tissue_mg_row_C <- as.numeric(gsub("A2-gluc-", "", plate_layout[3, gluc_sample_cols]))
gluc_tissue_mg_row_D <- as.numeric(gsub("A2-gluc-", "", plate_layout[4, gluc_sample_cols]))
gluc_sample_luminescence_row_C <- as.numeric(raw_luminescence[3, gluc_sample_cols])
gluc_sample_luminescence_row_D <- as.numeric(raw_luminescence[4, gluc_sample_cols])

# Combine the two rows of samples
gluc_tissue_mg <- c(gluc_tissue_mg_row_C, gluc_tissue_mg_row_D)
gluc_sample_luminescence <- c(gluc_sample_luminescence_row_C, gluc_sample_luminescence_row_D)
```


### Calculate summary statistics and linear regression
```{r glucose-summary-data, include=TRUE}
#| results: hold


# Calculate mean and standard error for each concentration
gluc_means <- numeric(length(gluc_concentrations))
gluc_std_errors <- numeric(length(gluc_concentrations))
gluc_std_devs <- numeric(length(gluc_concentrations))

for (i in 1:length(gluc_concentrations)) {
  values <- c(gluc_row_E[i], gluc_row_F[i], gluc_row_G[i])
  gluc_means[i] <- mean(values)
  gluc_std_devs[i] <- sd(values)
  gluc_std_errors[i] <- sd(values) / sqrt(length(values))
}

# Create data frame for plotting
glucose_summary_data <- data.frame(
  concentration = gluc_concentrations,
  mean_luminescence = gluc_means,
  se = gluc_std_errors,
  sd = gluc_std_devs,
  cv = (gluc_std_devs / gluc_means) * 100
)

# Calculate linear regression and R-squared
gluc_lm_model <- lm(mean_luminescence ~ concentration, data = glucose_summary_data)
gluc_r_squared <- summary(gluc_lm_model)$r.squared
gluc_slope <- coef(gluc_lm_model)[2]
gluc_intercept <- coef(gluc_lm_model)[1]

# Create sample data frame
# Calculate glucose concentration from luminescence using the standard curve equation
# Rearranging y = mx + b to solve for x: x = (y - b) / m
gluc_sample_conc <- (gluc_sample_luminescence - gluc_intercept) / gluc_slope

gluc_sample_data <- data.frame(
  tissue_mg = gluc_tissue_mg,
  luminescence = gluc_sample_luminescence,
  glucose_conc = gluc_sample_conc,
  label = paste(gluc_tissue_mg, "mg")
)
```

### Plot Glucose Standard Curve with Sample Points
```{r plot-glucose-data, fig.width=10, fig.height=6, include=TRUE}
# Create the plot
gluc_plot <- ggplot(glucose_summary_data, aes(x = concentration, y = mean_luminescence)) +
  geom_smooth(aes(linetype = "Std Curve Best Fit Line"), method = "lm", se = FALSE, 
              color = "coral", linewidth = 1) +
  geom_errorbar(aes(ymin = mean_luminescence - se, ymax = mean_luminescence + se),
                width = 0.1, linewidth = 1, color = "darkblue") +
  geom_point(aes(color = "Standard Curve", shape = "Standard Curve"), size = 4) +
  geom_point(data = gluc_sample_data, aes(x = glucose_conc, y = luminescence,
             color = label, shape = label), size = 4) +
  scale_color_manual(name = "",
                     values = c("Standard Curve" = "steelblue",
                                "50 mg" = "darkred",
                                "2.5 mg" = "darkorange",
                                "0.25 mg" = "darkgreen",
                                "0.025 mg" = "purple",
                                "0 mg" = "brown")) +
  scale_shape_manual(name = "",
                     values = c("Standard Curve" = 16,
                                "50 mg" = 17,
                                "2.5 mg" = 15,
                                "0.25 mg" = 18,
                                "0.025 mg" = 8,
                                "0 mg" = 4)) +
  scale_linetype_manual(name = "",
                        values = c("Std Curve Best Fit Line" = "dashed")) +
  annotate("label", x = max(glucose_summary_data$concentration) * 0.75, 
           y = max(glucose_summary_data$mean_luminescence) * 0.15,
           label = sprintf("y = %.2fx + %.2f\nR² = %.4f", gluc_slope, gluc_intercept, gluc_r_squared),
           size = 3.5, fontface = "bold", fill = "white", 
           color = "coral", label.padding = unit(0.3, "lines")) +
  labs(
    title = "Glucose Standard Curve",
    x = "Glucose Concentration (µg/µL)",
    y = "Luminescence",
    caption = "Error bars represent standard error of the mean (SEM)"
  ) +
  scale_x_continuous(breaks = gluc_concentrations) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12, face = "bold"),
    panel.grid.minor = element_line(linetype = "dashed", color = "grey70")
  )

# Save the plot
ggsave("../output/00.00-mgig-A2-dilutions_tests.Rmd/glucose_plot.png", gluc_plot, width = 10, height = 6, dpi = 300)

# Display the plot
gluc_plot

# Print summary statistics
cat("Glucose Standard Curve Summary:\n")
cat(rep("=", 50), "\n", sep = "")
for (i in 1:nrow(glucose_summary_data)) {
  cat(sprintf("Concentration: %g µg/µL\n", glucose_summary_data$concentration[i]))
  cat(sprintf("  Mean Luminescence: %.2f\n", glucose_summary_data$mean_luminescence[i]))
  cat(sprintf("  Standard Error: %.2f\n", glucose_summary_data$se[i]))
  cat(sprintf("  CV%%: %.2f%%\n\n", glucose_summary_data$cv[i]))
}
```